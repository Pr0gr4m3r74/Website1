<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Karten-Mini-Game</title>
<link rel="stylesheet" href="minigame.css">
<style>
:root{
  --bg:#031022;
  --panel:#0b2036;
  --muted:#94a3b8;
  --accent:#38bdf8;
}
* { box-sizing: border-box; }
body {
  margin: 0;
  font-family: Inter, Arial, sans-serif;
  background: linear-gradient(180deg,#021022 0%, var(--bg) 100%);
  color: #e5e7eb;
  min-height: 100vh;
  display:flex;
  flex-direction:column;
}
header {
  background: #020617;
  padding: 16px 12px;
  text-align:center;
  box-shadow: 0 2px 8px rgba(0,0,0,0.6);
}
nav a { margin: 0 12px; color: var(--accent); text-decoration:none; font-weight:600; }
footer { background:#020617; text-align:center; padding:14px; font-size:14px; color:var(--muted); margin-top:auto; }

.main-container {
  display:flex;
  justify-content:center;
  gap:32px;
  padding:28px;
  align-items:center; /* Altar mittig vertikal zur Game-Area */
  width:100%;
  max-width:1280px;
  margin:0 auto;
}

/* ===== Altar (verziert, gr√∂√üer) ===== */
#altar {
  width: 380px; /* etwas gr√∂√üer */
  background:
    radial-gradient(160px 100px at 50% 0%, rgba(255,255,255,0.03), transparent 16%),
    linear-gradient(180deg,#07122a 0%, #0b2036 45%, #071224 100%);
  padding:12px 20px 20px 20px; /* oben etwas weniger, damit Titel im Rahmen sitzt */
  border-radius:18px;
  box-shadow: 0 14px 40px rgba(2,6,23,0.75), inset 0 3px 14px rgba(255,255,255,0.02);
  border: 1px solid rgba(255,255,255,0.04);
  position:relative;
  overflow:visible;
}
#altar:before {
  content: "";
  position:absolute;
  left:50%;
  transform:translateX(-50%);
  top:-18px; /* Dekoration etwas n√§her an Box */
  width:180px;
  height:48px;
  background: linear-gradient(90deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
  border-radius:26px;
  box-shadow: 0 8px 22px rgba(0,0,0,0.6);
  filter: blur(0.8px);
  opacity:0.95;
}
#altar h3 { text-align:center; margin:-6px 0 10px 0; font-size:19px; letter-spacing:0.6px; }

/* kleine Anpassung: Slots dichter zusammen */
#altar-slots {
  display:flex;
  justify-content:space-between;
  gap:12px;
  margin-top:8px;
}
.altar-slot {
  width:100px;
  height:160px;
  border-radius:14px;
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.12));
  border: 2px dashed rgba(145,158,171,0.12);
  display:flex;
  align-items:center;
  justify-content:center;
  position:relative;
  transition: transform 0.12s ease, box-shadow 0.12s ease, background 0.12s;
}
.altar-slot.over {
  transform: translateY(-6px);
  box-shadow: 0 18px 36px rgba(56,189,248,0.06), 0 0 0 4px rgba(56,189,248,0.03) inset;
  border-style:solid;
  border-color: rgba(56,189,248,0.25);
}
#altar button {
  width:100%;
  margin-top:14px;
  padding:14px;
  border-radius:12px;
  background: linear-gradient(180deg,#06b6d4,#0ea5e9);
  border:none;
  color:#021023;
  font-weight:900;
  font-size:17px;
  cursor:pointer;
  box-shadow: 0 8px 22px rgba(10,20,40,0.55);
}
#altar-result {
  text-align:center;
  margin-top:14px;
  color:var(--accent);
  font-weight:800;
  min-height:46px;
}

/* ===== Game area ===== */
.game-area { flex:1; text-align:center; min-width:0; }
.game-controls { display:flex; justify-content:center; gap:16px; align-items:center; margin-bottom:6px; }
.game-controls button {
  padding:14px 18px;
  border-radius:12px;
  border:none;
  background: linear-gradient(180deg,#374151,#111827);
  color:#e5e7eb;
  cursor:pointer;
  font-weight:900;
  font-size:16px;
  box-shadow: 0 8px 22px rgba(2,6,23,0.6);
}
#currentCard { margin: 6px auto; width:180px; }

/* ===== Inventory (zentriert, symmetrisch) ===== */
.inventory {
  display:grid;
  grid-template-columns: repeat(auto-fit, 160px); /* feste Spaltenbreite -> symmetrisch */
  justify-content:center; /* zentriert */
  gap:18px;
  margin-top:18px;
  align-items:start;
  padding:10px;
  min-height:10px;
  border-radius:8px;
}

/* ===== Karten & Verzierung ===== */
.card, .small-card {
  border-radius:14px;
  padding:12px;
  color:#fff;
  text-align:center;
  font-weight:800;
  position:relative;
  box-shadow: 0 10px 30px rgba(2,6,23,0.7);
  transition: transform 0.16s ease, opacity 0.12s;
  user-select:none;
  overflow:visible;
}
/* gro√üe Karte (im Vorschau) soll Scrollen nicht blocken */
.card { width:180px; height:240px; display:flex; flex-direction:column; justify-content:space-between; margin:0 auto; touch-action: pan-y; }
.small-card { width:160px; height:180px; display:flex; flex-direction:column; justify-content:space-between; cursor:grab; overflow:visible; touch-action: pan-y; }
/* touch-action: pan-y erlaubt Scrollen bei Touch w√§hrend Drag */
.small-card.dragging { opacity:0.78; transform:scale(1.04); cursor:grabbing; z-index:60; }

/* Ornament (sichtbar auf jeder Karte) */
.small-card .ornament, .card .ornament {
  position:absolute;
  left:10px;
  top:10px;
  width:36px;
  height:36px;
  border-radius:9px;
  background: linear-gradient(45deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:16px;
  opacity:0.98;
  box-shadow: 0 6px 12px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.03);
}
.stars { margin-top:6px; font-size:14px; }

/* Insert hint (wenn man in Inventar neu anordnet) */
.small-card.insert-before {
  transform: translateY(-8px);
  box-shadow: 0 24px 40px rgba(0,0,0,0.65);
  outline: 2px dashed rgba(255,255,255,0.06);
}

/* ===== Rarity styles (bunter / wild + Ornamentfarben) ===== */
/* Farben lebendiger gemacht, damit die Karten weniger eint√∂nig wirken */
.common {
  background: linear-gradient(135deg,#8fbf8f 0%, #6ea06e 60%, #4f7f4f 100%);
  border: 2px solid rgba(255,255,255,0.04);
}
.common .ornament { background: linear-gradient(135deg,#dfffe0,#bfeebb); color:#07200a; }

.rare {
  background: linear-gradient(135deg,#38bdf8 0%, #60a5fa 55%, #2563eb 100%);
  border: 2px solid rgba(96,165,250,0.18);
}
.rare .ornament { background: linear-gradient(45deg,#7dd3fc,#0369a1); color:#021023; }

.epic {
  background: linear-gradient(135deg,#7c3aed 0%, #c084fc 50%, #ec4899 100%);
  border: 2px solid rgba(216,180,254,0.22);
}
.epic .ornament { background: linear-gradient(45deg,#f0abfc,#7c3aed); color:#1a042e; }

.legendary {
  background: linear-gradient(135deg,#ffb86b 0%, #f97316 45%, #d97706 100%);
  border: 2px solid rgba(255,206,125,0.22);
}
.legendary .ornament { background: linear-gradient(45deg,#ffd27a,#ff8a00); color:#2a1200; }

.mythic {
  background: linear-gradient(135deg,#ff7ab6 0%, #ff5f6d 40%, #7f1d1d 100%);
  border: 2px solid rgba(252,165,165,0.24);
}
.mythic .ornament { background: linear-gradient(45deg,#ff8a8a,#ffcf93); color:#3a0a0a; }

/* Altarkarten: reduzierte Optik passt sich an */
.altar-slot .small-card { width:100%; height:100%; box-shadow:none; border-radius:10px; padding:10px; }

/* kleine Feinheiten */
.small-card .name, .card .name { font-size:13px; }
.rarity { font-size:12px; opacity:0.95; margin-top:6px; display:block; }

/* Responsive */
@media (max-width:900px){
  .main-container { flex-direction:column; align-items:center; padding:16px; }
  #altar { width:92%; }
  .altar-slot { width:32%; height:140px; }
  .inventory { grid-template-columns: repeat(auto-fit, 140px); }
}
</style>
</head>
<body>
<header>
  <h1>Karten-Mini-Game</h1>
  <nav>
    <a href="index.html">Start</a>
    <a href="minigames.html">Mini-Games</a>
    <a href="kontakt.html">Kontakt</a>
    <a href="impressum.html">Impressum</a>
  </nav>
</header>

<div class="main-container">
  <div id="altar">
    <h3>Altar</h3>
    <div id="altar-slots">
      <div class="altar-slot" data-index="0"></div>
      <div class="altar-slot" data-index="1"></div>
      <div class="altar-slot" data-index="2"></div>
    </div>
    <button id="sacrificeBtn">Opfern & Belohnung</button>
    <div id="altar-result"></div>
  </div>

  <div class="game-area">
    <div class="game-controls">
      <button id="drawBtn">Karte ziehen</button>
      <div id="currentCard"></div>
    </div>

    <h2>Inventar</h2>
    <div id="inventory" class="inventory" aria-live="polite"></div>
  </div>
</div>

<footer>¬© 2026 IT Solutions</footer>

<script>
/* Daten & Mapping */
const rarities = [
  { name: 'Gew√∂hnlich', chance: 70 },
  { name: 'Selten', chance: 20 },
  { name: 'Episch', chance: 8 },
  { name: 'Legend√§r', chance: 1.99 },
  { name: 'Mythisch', chance: 0.01 }
];
const rarityMap = {
  'Gew√∂hnlich': 'common',
  'Selten': 'rare',
  'Episch': 'epic',
  'Legend√§r': 'legendary',
  'Mythisch': 'mythic'
};
const tiers = ['Gew√∂hnlich','Selten','Episch','Legend√§r','Mythisch'];

const allCards = [
  { name: 'Erd-Essenz', icon: '‚¨õ', rarity: 'Gew√∂hnlich' },
  { name: 'Holz-Essenz', icon: 'üü´', rarity: 'Gew√∂hnlich' },
  { name: 'Wasser-Essenz', icon: 'üíß', rarity: 'Gew√∂hnlich' },
  { name: 'Wind-Essenz', icon: 'üå´Ô∏è', rarity: 'Gew√∂hnlich' },
  { name: 'Licht-Funke', icon: '‚ú®', rarity: 'Gew√∂hnlich' },
  { name: 'Schatten-Rest', icon: 'üåë', rarity: 'Gew√∂hnlich' },
  { name: 'Asche-Partikel', icon: 'üü§', rarity: 'Gew√∂hnlich' },
  { name: 'Kristall-Essenz', icon: 'üî∑', rarity: 'Selten' },
  { name: 'Energie-Kern', icon: 'üîã', rarity: 'Selten' },
  { name: 'Flammenkern', icon: 'üî•', rarity: 'Selten' },
  { name: 'Frostkern', icon: '‚ùÑÔ∏è', rarity: 'Selten' },
  { name: 'Gold-Matrix', icon: 'üü®', rarity: 'Episch' },
  { name: 'Astral-Kern', icon: 'üåå', rarity: 'Episch' },
  { name: 'Zeit-Fragment', icon: '‚è≥', rarity: 'Episch' },
  { name: 'Lichtkristall', icon: 'üíé', rarity: 'Episch' },
  { name: 'Klinge der Ordnung', icon: 'üó°Ô∏è', rarity: 'Legend√§r' },
  { name: 'Bogen der Weite', icon: 'üèπ', rarity: 'Legend√§r' },
  { name: 'Siegel der Macht', icon: 'üî±', rarity: 'Legend√§r' },
  { name: 'Krone der Herrschaft', icon: 'üëë', rarity: 'Legend√§r' },
  { name: 'Singularit√§t', icon: '‚ö´', rarity: 'Mythisch' },
  { name: 'Paradox', icon: '‚ö™', rarity: 'Mythisch' }
];

let inventory = [];
let altarSlots = [null, null, null];

/* Utility */
function rarityClass(r) { return rarityMap[r] || r.toLowerCase(); }
function weightedRandomRarity() {
  let roll = Math.random()*100, sum=0;
  for (let r of rarities){ sum+=r.chance; if (roll<=sum) return r.name; }
  return rarities[0].name;
}
function pickRandomCardByRarity(rarity){
  const arr = allCards.filter(c => c.rarity === rarity);
  return { ...arr[Math.floor(Math.random()*arr.length)] };
}
function moveInArray(arr, from, to){
  if (from === to) return;
  const item = arr.splice(from,1)[0];
  arr.splice(to,0,item);
}
function randomQuality(){
  const qRoll = Math.random()*100;
  if (qRoll <= 50) return 1 + Math.floor(Math.random()*2); // 1-2
  else if (qRoll <= 80) return 3;
  else if (qRoll <= 95) return 4;
  else return 5;
}

/* Draw */
function drawCard(){
  let rarity = weightedRandomRarity();
  let card = pickRandomCardByRarity(rarity);
  card.quality = randomQuality();
  inventory.push(card);
  showCurrentCard(card);
  renderInventory();
}

/* Anzeige der aktuellen Karte */
function showCurrentCard(card){
  const div = document.getElementById('currentCard');
  let stars = '‚ú¶'.repeat(card.quality);
  div.innerHTML = `<div class="card ${rarityClass(card.rarity)}">
    <div class="ornament">${card.icon}</div>
    <div class="rarity">${card.rarity}</div>
    <div class="name">${card.name}</div>
    <div class="icon" style="font-size:48px">${card.icon}</div>
    <div class="stars">${stars}</div>
  </div>`;
}

/* Inventar rendern */
function renderInventory(){
  const inv = document.getElementById('inventory');
  inv.innerHTML = '';
  inventory.forEach((c,i) => {
    const d = document.createElement('div');
    d.className = `small-card ${rarityClass(c.rarity)}`;
    d.draggable = true;
    d.dataset.index = i;
    let stars = '‚ú¶'.repeat(c.quality);
    d.innerHTML = `<div class="ornament">${c.icon}</div><div class="rarity">${c.rarity}</div><div class="name">${c.name}</div><div class="icon" style="font-size:36px">${c.icon}</div><div class="stars">${stars}</div>`;
    inv.appendChild(d);
  });
  attachDraggables();
  renderAltar();
}

/* Drag handlers f√ºr Inventarkarten (Start / Ende) */
function attachDraggables(){
  const cards = document.querySelectorAll('#inventory .small-card');
  cards.forEach(card => {
    card.addEventListener('dragstart', e => {
      // set data
      e.dataTransfer.setData('text/plain', 'inv:' + card.dataset.index);
      // hide default drag image to make drag less disruptive
      try { e.dataTransfer.setDragImage(new Image(), 0, 0); } catch(e){}
      card.classList.add('dragging');
      try { e.dataTransfer.effectAllowed = 'move'; } catch(e){}
    });
    card.addEventListener('dragend', e => { card.classList.remove('dragging'); });
    // drop on a card -> insert before this card
    card.addEventListener('dragover', e => {
      e.preventDefault();
      card.classList.add('insert-before');
    });
    card.addEventListener('dragleave', e => { card.classList.remove('insert-before'); });
    card.addEventListener('drop', e => {
      e.preventDefault();
      card.classList.remove('insert-before');
      const data = e.dataTransfer.getData('text/plain');
      const targetIdx = Number(card.dataset.index);
      if (!data) return;
      if (data.startsWith('inv:')){
        const srcIdx = Number(data.split(':')[1]);
        if (isNaN(srcIdx)) return;
        // adjust target when removing earlier element
        let dest = targetIdx;
        if (srcIdx < dest) dest = dest - 1;
        moveInArray(inventory, srcIdx, dest);
        renderInventory();
      } else if (data.startsWith('altar:')){
        const aIdx = Number(data.split(':')[1]);
        if (isNaN(aIdx)) return;
        const cardObj = altarSlots[aIdx];
        if (!cardObj) return;
        altarSlots[aIdx] = null;
        inventory.splice(targetIdx,0,cardObj);
        renderInventory();
      }
    });
  });
}

/* Altar Rendering & Drag from altar */
function renderAltar(){
  const slots = document.querySelectorAll('.altar-slot');
  slots.forEach(slotEl => {
    const idx = Number(slotEl.dataset.index);
    slotEl.innerHTML = '';
    if (altarSlots[idx]){
      const c = altarSlots[idx];
      const d = document.createElement('div');
      d.className = `small-card ${rarityClass(c.rarity)}`;
      d.draggable = true;
      d.dataset.altarIndex = idx;
      d.innerHTML = `<div class="ornament">${c.icon}</div><div class="rarity">${c.rarity}</div><div class="name">${c.name}</div><div class="icon" style="font-size:36px">${c.icon}</div><div class="stars">${'‚ú¶'.repeat(c.quality)}</div>`;
      d.addEventListener('dragstart', e => {
        e.dataTransfer.setData('text/plain', 'altar:' + idx);
        try { e.dataTransfer.setDragImage(new Image(), 0, 0); } catch(e){}
        d.classList.add('dragging');
        try{ e.dataTransfer.effectAllowed = 'move'; } catch(e){}
      });
      d.addEventListener('dragend', e => { d.classList.remove('dragging'); });
      slotEl.appendChild(d);
    }
  });
}

/* Altar slots droppable */
const altarSlotElements = document.querySelectorAll('.altar-slot');
altarSlotElements.forEach(slot => {
  slot.addEventListener('dragover', e => {
    e.preventDefault();
    slot.classList.add('over');
  });
  slot.addEventListener('dragleave', e => slot.classList.remove('over'));
  slot.addEventListener('drop', e => {
    e.preventDefault();
    slot.classList.remove('over');
    const data = e.dataTransfer.getData('text/plain');
    const slotIdx = Number(slot.dataset.index);
    if (!data) return;
    if (data.startsWith('inv:')){
      const invIdx = Number(data.split(':')[1]);
      if (isNaN(invIdx) || invIdx < 0 || invIdx >= inventory.length) return;
      const card = inventory.splice(invIdx,1)[0];
      if (altarSlots[slotIdx]){
        // tausche: vorherige Karte zur√ºck ins Inventar (ans Ende)
        inventory.push(altarSlots[slotIdx]);
      }
      altarSlots[slotIdx] = card;
      renderInventory();
    } else if (data.startsWith('altar:')){
      const fromIdx = Number(data.split(':')[1]);
      if (isNaN(fromIdx) || fromIdx < 0 || fromIdx >= altarSlots.length) return;
      if (fromIdx === slotIdx) return;
      const tmp = altarSlots[slotIdx];
      altarSlots[slotIdx] = altarSlots[fromIdx];
      altarSlots[fromIdx] = tmp;
      renderAltar();
    }
  });
});

/* Ziehen vom Altar zur√ºck ins Inventar (auf leeren Inventarbereich = ans Ende) */
const inventoryEl = document.getElementById('inventory');
inventoryEl.addEventListener('dragover', e => e.preventDefault());
inventoryEl.addEventListener('drop', e => {
  e.preventDefault();
  const data = e.dataTransfer.getData('text/plain');
  if (!data) return;
  if (data.startsWith('altar:')){
    const idx = Number(data.split(':')[1]);
    if (isNaN(idx)) return;
    const card = altarSlots[idx];
    if (!card) return;
    altarSlots[idx] = null;
    inventory.push(card);
    renderInventory();
  } else if (data.startsWith('inv:')){
    // wenn auf freien Bereich fallen, ans Ende verschieben
    const src = Number(data.split(':')[1]);
    if (isNaN(src)) return;
    moveInArray(inventory, src, Math.max(0, inventory.length-1));
    renderInventory();
  }
});

/* Opfer- / Belohnungslogik
   Regeln:
   - Wenn alle 3 belegten Slots dieselbe Seltenheit haben -> garantiert n√§chsth√∂here Seltenheit (falls vorhanden).
   - Sonstige Logik: highest rarity + Chance auf bump basierend auf Qualit√§t.
   - Belohnung bekommt immer eine zuf√§llige Qualit√§t (randomQuality()).
*/
function summonFromAltar(){
  const filled = altarSlots.filter(s => s !== null);
  if (filled.length === 0){
    document.getElementById('altar-result').textContent = 'Leerer Altar ‚Äî lege Karten hinein.';
    return;
  }

  // counts & quick-check ob alle 3 gleich (und es sind 3 gelegt)
  const counts = {};
  altarSlots.forEach(s => { if (s) counts[s.rarity] = (counts[s.rarity]||0) + 1; });

  if (filled.length === 3){
    const raritiesSet = Object.keys(counts);
    if (raritiesSet.length === 1){
      // alle drei gleich -> garantierter Bump um 1 Tier (wenn m√∂glich)
      const currentRarity = raritiesSet[0];
      const idx = Math.max(0, tiers.indexOf(currentRarity));
      const rewardIndex = Math.min(idx + 1, tiers.length - 1);
      const reward = pickRandomCardByRarity(tiers[rewardIndex]);
      reward.quality = randomQuality();
      altarSlots = [null, null, null];
      inventory.push(reward);
      renderInventory();
      document.getElementById('altar-result').innerHTML = `Opfer erfolgreich: 3 √ó ${currentRarity} ‚Üí Belohnung: <strong>${reward.name}</strong> ${reward.icon} (${reward.rarity})`;
      return;
    }
  }

  // sonstige Logik wie vorher: highest rarity + chance auf bump basierend auf Qualit√§t
  let maxIndex = 0;
  altarSlots.forEach(s => { if (!s) return; const idx = tiers.indexOf(s.rarity); if (idx > maxIndex) maxIndex = idx; });
  const totalQuality = filled.reduce((a,b)=>a+(b?b.quality:0),0);
  let bumpChance = Math.min(0.25 + (totalQuality - filled.length)*0.06, 0.6);
  let rewardIndex = Math.min(maxIndex + (Math.random() < bumpChance ? 1 : 0), tiers.length-1);
  const reward = pickRandomCardByRarity(tiers[rewardIndex]);
  reward.quality = randomQuality();
  altarSlots = [null, null, null];
  inventory.push(reward);
  renderInventory();
  document.getElementById('altar-result').innerHTML = `Belohnung erhalten: <strong>${reward.name}</strong> ${reward.icon} (${reward.rarity})`;
}

/* Hook Buttons */
document.getElementById('drawBtn').addEventListener('click', drawCard);
document.getElementById('sacrificeBtn').addEventListener('click', summonFromAltar);

/* Init - Demo Startkarten */
(function initDemo(){
  for (let i=0;i<4;i++) drawCard();
})();
</script>
</body>
</html>
