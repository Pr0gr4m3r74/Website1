<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Karten-Mini-Game</title>
<link rel="stylesheet" href="minigame.css">
<style>
/* ===== Layout ===== */
:root{
  --bg:#0f172a;
  --panel:#1e293b;
  --muted:#94a3b8;
  --accent:#38bdf8;
}
* { box-sizing: border-box; }
body {
  margin: 0;
  font-family: Inter, Arial, sans-serif;
  background: linear-gradient(180deg,#071028 0%, var(--bg) 100%);
  color: #e5e7eb;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}
header {
  background: #020617;
  padding: 18px 12px;
  text-align: center;
  box-shadow: 0 2px 8px rgba(0,0,0,0.6);
}
nav a {
  margin: 0 12px;
  color: var(--accent);
  text-decoration: none;
  font-weight: 600;
}
footer {
  background: #020617;
  text-align: center;
  padding: 14px;
  font-size: 14px;
  color: var(--muted);
  margin-top: auto;
}

.main-container {
  display: flex;
  justify-content: center;
  gap: 24px;
  padding: 28px;
  align-items: flex-start;
  width: 100%;
  max-width: 1100px;
  margin: 0 auto;
}

#altar {
  width: 260px;
  background: var(--panel);
  padding: 16px;
  border-radius: 12px;
  margin-right: 0;
  flex-shrink: 0;
}
#altar h3 {
  text-align: center;
  margin: 0 0 8px 0;
}
#altar-slots {
  display: flex;
  justify-content: space-between;
  gap: 8px;
  margin-top: 10px;
}
.altar-slot {
  width: 76px;
  height: 120px;
  border: 2px dashed #94a3b8;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #07102a;
  color: #fff;
  position: relative;
  transition: background 0.15s, transform 0.12s;
}
.altar-slot.over {
  background: rgba(56,189,248,0.06);
  transform: translateY(-4px);
  border-style: solid;
  border-color: var(--accent);
}
#altar button {
  width: 100%;
  margin-top: 10px;
  padding: 8px;
  border-radius: 8px;
  background: linear-gradient(180deg,#38bdf8,#0ea5e9);
  border: none;
  color: #021023;
  font-weight: 700;
  cursor: pointer;
}
#altar-result {
  text-align: center;
  margin-top: 10px;
  color: var(--accent);
  font-weight: bold;
  min-height: 40px;
}

/* ===== Game area ===== */
.game-area {
  flex: 1;
  text-align: center;
  min-width: 0;
}
.game-controls {
  display:flex;
  justify-content:center;
  gap:12px;
  align-items:center;
}
.game-controls button {
  padding: 8px 12px;
  border-radius: 8px;
  border: none;
  background: #111827;
  color: #e5e7eb;
  cursor: pointer;
  font-weight: 600;
}
#currentCard {
  margin: 16px auto;
  width: 160px;
}

/* ===== Inventory ===== */
.inventory {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
  gap: 14px;
  margin-top: 20px;
  align-items: start;
  justify-items: center;
  padding-bottom: 8px;
}

/* ===== Karten ===== */
.card, .small-card {
  border-radius: 12px;
  padding: 10px;
  color: #fff;
  text-align: center;
  font-weight: 700;
  position: relative;
  box-shadow: 0 6px 18px rgba(2,6,23,0.6);
  transition: transform 0.18s ease, opacity 0.12s;
  user-select: none;
}
.card {
  width: 160px;
  height: 220px;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  margin: 0 auto;
}
.small-card {
  width: 140px;
  height: 160px; /* schlanker als vorher */
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  cursor: grab;
  overflow: hidden;
}
.small-card.dragging {
  opacity: 0.75;
  transform: scale(1.06);
  cursor: grabbing;
}
.icon {
  font-size: 44px;
  margin: 6px 0;
}
.stars {
  margin-top: 6px;
  font-size: 14px;
}

/* ===== Seltenheit (klassen) ===== */
.common {
  background: linear-gradient(135deg,#6b7280,#4b5563);
  border: 2px solid rgba(163,230,53,0.08);
}
.rare {
  background: linear-gradient(135deg,#2563eb,#1e40af);
  border: 2px solid rgba(96,165,250,0.12);
}
.epic {
  background: linear-gradient(135deg,#7c3aed,#5b21b6);
  border: 2px solid rgba(216,180,254,0.12);
}
.legendary {
  background: linear-gradient(135deg,#f59e0b,#b45309);
  border: 2px solid rgba(253,230,138,0.12);
}
.mythic {
  background: linear-gradient(135deg,#dc2626,#7f1d1d);
  border: 2px solid rgba(252,165,165,0.12);
}

/* kleine Feinheiten */
.small-card .name, .card .name { font-size: 14px; }
.rarity { font-size: 12px; opacity: 0.9; margin-top: 6px; }
.altar-slot .small-card { width: 100%; height: 100%; box-shadow:none; border-radius:8px; padding:6px; }
</style>
</head>
<body>
<header>
  <h1>Karten-Mini-Game</h1>
  <nav>
    <a href="index.html">Start</a>
    <a href="minigame.html">Mini-Game</a>
    <a href="kontakt.html">Kontakt</a>
    <a href="impressum.html">Impressum</a>
  </nav>
</header>

<div class="main-container">
  <div id="altar">
    <h3>Altar</h3>
    <div id="altar-slots">
      <div class="altar-slot" data-index="0"></div>
      <div class="altar-slot" data-index="1"></div>
      <div class="altar-slot" data-index="2"></div>
    </div>
    <button id="sacrificeBtn">Opfern & Belohnung</button>
    <div id="altar-result"></div>
  </div>

  <div class="game-area">
    <div class="game-controls">
      <button id="drawBtn">Karte ziehen</button>
      <div id="currentCard"></div>
    </div>

    <h2>Inventar</h2>
    <div id="inventory" class="inventory" aria-live="polite"></div>
  </div>
</div>

<footer>¬© 2026 IT Solutions</footer>

<script>
/* Daten & Mapping */
const rarities = [
  { name: 'Gew√∂hnlich', chance: 70 },
  { name: 'Selten', chance: 20 },
  { name: 'Episch', chance: 8 },
  { name: 'Legend√§r', chance: 1.99 },
  { name: 'Mythisch', chance: 0.01 }
];

const rarityMap = {
  'Gew√∂hnlich': 'common',
  'Selten': 'rare',
  'Episch': 'epic',
  'Legend√§r': 'legendary',
  'Mythisch': 'mythic'
};

const tiers = ['Gew√∂hnlich','Selten','Episch','Legend√§r','Mythisch'];

const allCards = [
  { name: 'Erd-Essenz', icon: '‚¨õ', rarity: 'Gew√∂hnlich' },
  { name: 'Holz-Essenz', icon: 'üü´', rarity: 'Gew√∂hnlich' },
  { name: 'Wasser-Essenz', icon: 'üíß', rarity: 'Gew√∂hnlich' },
  { name: 'Wind-Essenz', icon: 'üå´Ô∏è', rarity: 'Gew√∂hnlich' },
  { name: 'Licht-Funke', icon: '‚ú®', rarity: 'Gew√∂hnlich' },
  { name: 'Schatten-Rest', icon: 'üåë', rarity: 'Gew√∂hnlich' },
  { name: 'Asche-Partikel', icon: 'üü§', rarity: 'Gew√∂hnlich' },
  { name: 'Kristall-Essenz', icon: 'üî∑', rarity: 'Selten' },
  { name: 'Energie-Kern', icon: 'üîã', rarity: 'Selten' },
  { name: 'Flammenkern', icon: 'üî•', rarity: 'Selten' },
  { name: 'Frostkern', icon: '‚ùÑÔ∏è', rarity: 'Selten' },
  { name: 'Gold-Matrix', icon: 'üü®', rarity: 'Episch' },
  { name: 'Astral-Kern', icon: 'üåå', rarity: 'Episch' },
  { name: 'Zeit-Fragment', icon: '‚è≥', rarity: 'Episch' },
  { name: 'Lichtkristall', icon: 'üíé', rarity: 'Episch' },
  { name: 'Klinge der Ordnung', icon: 'üó°Ô∏è', rarity: 'Legend√§r' },
  { name: 'Bogen der Weite', icon: 'üèπ', rarity: 'Legend√§r' },
  { name: 'Siegel der Macht', icon: 'üî±', rarity: 'Legend√§r' },
  { name: 'Krone der Herrschaft', icon: 'üëë', rarity: 'Legend√§r' },
  { name: 'Singularit√§t', icon: '‚ö´', rarity: 'Mythisch' },
  { name: 'Paradox', icon: '‚ö™', rarity: 'Mythisch' }
];

let inventory = [];
let altarSlots = [null, null, null];

/* Utility */
function rarityClass(rarityName){
  return rarityMap[rarityName] || rarityName.toLowerCase();
}
function weightedRandomRarity(){
  let roll = Math.random() * 100;
  let sum = 0;
  for (let r of rarities) {
    sum += r.chance;
    if (roll <= sum) return r.name;
  }
  return rarities[0].name;
}
function pickRandomCardByRarity(rarity){
  const arr = allCards.filter(c => c.rarity === rarity);
  return { ...arr[Math.floor(Math.random()*arr.length)] };
}

/* Draw */
function drawCard(){
  let rarity = weightedRandomRarity();
  let card = pickRandomCardByRarity(rarity);
  // Qualit√§t
  let qRoll = Math.random()*100;
  if (qRoll <= 50) card.quality = 1 + Math.floor(Math.random() * 2); // 1-2
  else if (qRoll <= 80) card.quality = 3;
  else if (qRoll <= 95) card.quality = 4;
  else card.quality = 5;
  inventory.push(card);
  showCurrentCard(card);
  renderInventory();
}

/* Anzeige der aktuellen Karte */
function showCurrentCard(card){
  const div = document.getElementById('currentCard');
  let stars = '‚ú¶'.repeat(card.quality);
  div.innerHTML = `<div class="card ${rarityClass(card.rarity)}">
    <div class="rarity">${card.rarity}</div>
    <div class="name">${card.name}</div>
    <div class="icon">${card.icon}</div>
    <div class="stars">${stars}</div>
  </div>`;
}

/* Inventar & Dragging */
function renderInventory(){
  const inv = document.getElementById('inventory');
  inv.innerHTML = '';
  inventory.forEach((c, i) => {
    const d = document.createElement('div');
    d.className = `small-card ${rarityClass(c.rarity)}`;
    d.draggable = true;
    d.dataset.index = i; // stabile Zuordnung
    let stars = '‚ú¶'.repeat(c.quality);
    d.innerHTML = `<div class="rarity">${c.rarity}</div><div class="name">${c.name}</div><div class="icon">${c.icon}</div><div class="stars">${stars}</div>`;
    inv.appendChild(d);
  });
  attachDraggables();
  renderAltar(); // damit Altarkarten aktualisiert sind (z.B. nach Tausch)
}

function attachDraggables(){
  const cards = document.querySelectorAll('#inventory .small-card');
  cards.forEach(card => {
    card.addEventListener('dragstart', e => {
      e.dataTransfer.setData('text/plain', 'inv:' + card.dataset.index);
      card.classList.add('dragging');
    });
    card.addEventListener('dragend', e => {
      card.classList.remove('dragging');
    });
  });
}

/* Altar-Rendering & Drop-Handling */
function renderAltar(){
  const slots = document.querySelectorAll('.altar-slot');
  slots.forEach(slotEl => {
    const idx = Number(slotEl.dataset.index);
    slotEl.innerHTML = '';
    if (altarSlots[idx]){
      const c = altarSlots[idx];
      const d = document.createElement('div');
      d.className = `small-card ${rarityClass(c.rarity)}`;
      d.draggable = true;
      d.dataset.altarIndex = idx;
      d.innerHTML = `<div class="rarity">${c.rarity}</div><div class="name">${c.name}</div><div class="icon">${c.icon}</div><div class="stars">${'‚ú¶'.repeat(c.quality)}</div>`;
      // Drag from altar back to inventory or to another slot
      d.addEventListener('dragstart', e => {
        e.dataTransfer.setData('text/plain', 'altar:' + idx);
        d.classList.add('dragging');
      });
      d.addEventListener('dragend', e => {
        d.classList.remove('dragging');
      });
      slotEl.appendChild(d);
    }
  });
}

/* Altar Drop - Setup */
const altarSlotElements = document.querySelectorAll('.altar-slot');
altarSlotElements.forEach(slot => {
  slot.addEventListener('dragover', e => {
    e.preventDefault();
    slot.classList.add('over');
  });
  slot.addEventListener('dragleave', e => {
    slot.classList.remove('over');
  });
  slot.addEventListener('drop', e => {
    e.preventDefault();
    slot.classList.remove('over');
    const data = e.dataTransfer.getData('text/plain');
    const slotIdx = Number(slot.dataset.index);
    if (!data) return;
    if (data.startsWith('inv:')){
      const invIdx = Number(data.split(':')[1]);
      if (isNaN(invIdx) || invIdx < 0 || invIdx >= inventory.length) return;
      // Wenn Slot frei -> verschieben, sonst tauschen
      const card = inventory.splice(invIdx,1)[0];
      if (altarSlots[slotIdx]){
        // swap: zur√ºck in inventory an dieselbe Stelle (oder ans Ende)
        inventory.push(altarSlots[slotIdx]);
      }
      altarSlots[slotIdx] = card;
      renderInventory();
    } else if (data.startsWith('altar:')){
      const fromIdx = Number(data.split(':')[1]);
      if (isNaN(fromIdx) || fromIdx < 0 || fromIdx >= altarSlots.length) return;
      if (fromIdx === slotIdx) return;
      // swap altar slots
      const temp = altarSlots[slotIdx];
      altarSlots[slotIdx] = altarSlots[fromIdx];
      altarSlots[fromIdx] = temp;
      renderAltar();
    }
  });
});

/* Ziehen vom Altar in das Inventar (z.B. auf Inventarbereich) */
const inventoryEl = document.getElementById('inventory');
inventoryEl.addEventListener('dragover', e => e.preventDefault());
inventoryEl.addEventListener('drop', e => {
  e.preventDefault();
  const data = e.dataTransfer.getData('text/plain');
  if (!data) return;
  if (data.startsWith('altar:')){
    const idx = Number(data.split(':')[1]);
    if (isNaN(idx)) return;
    const card = altarSlots[idx];
    if (!card) return;
    // entferne vom Altar und ins Inventar
    altarSlots[idx] = null;
    inventory.push(card);
    renderInventory();
  }
});

/* Opfer- / Belohnungslogik */
function summonFromAltar(){
  const filled = altarSlots.filter(s => s !== null);
  if (filled.length === 0){
    document.getElementById('altar-result').textContent = 'Leerer Altar ‚Äî lege Karten hinein.';
    return;
  }
  // Ermittle h√∂chste Rarit√§t unter den geopferten Karten
  let maxIndex = 0;
  altarSlots.forEach(s => {
    if (!s) return;
    const idx = tiers.indexOf(s.rarity);
    if (idx > maxIndex) maxIndex = idx;
  });
  // Chance auf "Stufenanstieg" abh√§ngig von Gesamtqualit√§t
  const totalQuality = filled.reduce((a,b)=>a+(b?b.quality:0),0);
  let bumpChance = Math.min(0.25 + (totalQuality - filled.length)*0.06, 0.6); // max ~60%
  let rewardIndex = Math.min(maxIndex + (Math.random() < bumpChance ? 1 : 0), tiers.length-1);
  const reward = pickRandomCardByRarity(tiers[rewardIndex]);
  // clear altar
  altarSlots = [null, null, null];
  inventory.push(reward);
  renderInventory();
  document.getElementById('altar-result').innerHTML = `Belohnung erhalten: <strong>${reward.name}</strong> <span style="font-size:20px">${reward.icon}</span> (${reward.rarity})`;
}

/* Hook Buttons */
document.getElementById('drawBtn').addEventListener('click', drawCard);
document.getElementById('sacrificeBtn').addEventListener('click', summonFromAltar);

/* Init - ein paar Startkarten */
(function initDemo(){
  // ein paar Karten f√ºr Demozwecke
  for (let i=0;i<4;i++) drawCard();
})();
</script>
</body>
</html>
